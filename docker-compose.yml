# docker-compose.yml â€” WC Optimizer

services:
  ui:
    build: ./ui
    container_name: wc-optimizer-ui-1
    ports:
      - '8501:8501'
    environment:
      - API_BASE_URL=http://api:8000
    volumes:
      - ./data:/data
      - ./storage:/storage
      - ./ui:/app # live-reload: UI changes take effect without --build
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8501/_stcore/health')" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 40s

  api:
    build: ./api
    container_name: wc-optimizer-api-1
    ports:
      - '8000:8000'
    environment:
      - DUCKDB_PATH=/data/supply_chain.duckdb
      - FALKORDB_HOST=falkordb
      - FALKORDB_PORT=6379
      - MCP_SSE_PORT=3001
    volumes:
      - ./data:/data
      - ./storage:/storage
      - ./mcp_servers:/mcp_servers
      - ./api:/app # live-reload: API changes take effect without --build
    depends_on:
      falkordb:
        condition: service_healthy
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  mcp-sse:
    build:
      context: .
      dockerfile: mcp_servers/Dockerfile.sse
    container_name: wc-optimizer-mcp-sse-1
    ports:
      - '3001:3001'
    environment:
      - DUCKDB_PATH=/data/supply_chain.duckdb
      - FALKORDB_HOST=falkordb
      - FALKORDB_PORT=6379
    volumes:
      - ./data:/data
      - ./mcp_servers:/app/mcp_servers
    depends_on:
      api:
        condition: service_healthy
      falkordb:
        condition: service_healthy
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:3001/sse')" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s

  falkordb:
    image: falkordb/falkordb:latest
    container_name: wc-optimizer-falkordb-1
    ports:
      - '6379:6379'
    volumes:
      - falkordb_data:/data
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 10s

volumes:
  falkordb_data:
